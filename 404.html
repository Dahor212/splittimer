<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#0b3a67" />
  <title>SplitTimer</title>
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="apple-touch-icon" href="icons/icon-192.png" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div id="app">
    <header class="topbar">
      <button class="icon-btn" id="btnBack" aria-label="Zpƒõt" hidden>
        <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M15.5 5 9 12l6.5 7" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
      </button>
      <div class="title" id="topTitle">Moje Trasy</div>
      <div class="right">
        <button class="icon-btn" id="btnMenu" aria-label="Menu">
          <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M4 7h16M4 12h16M4 17h16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
        </button>
      </div>
    </header>


    <!-- SOURCE PICKER -->
    <main class="screen" id="screenSource" data-screen="source" hidden>
      <section class="pad">
        <div class="card pad">
          <div class="card-title">Vyber zdroj tras</div>
          <div class="hint">Trasy a ≈æeb≈ô√≠ƒçky budou oddƒõlen√© pro Zwift a Kinomap.</div>
        </div>
      </section>
      <section class="pad grid2">
        <button class="primary" id="btnPickZwift">Zwift</button>
        <button class="primary" id="btnPickKinomap">Kinomap</button>
      </section>
      <section class="pad">
        <div class="hint">V√Ωbƒõr lze kdykoliv zmƒõnit v Menu.</div>
      </section>
    </main>

    <!-- ROUTES LIST -->
    <main class="screen" id="screenRoutes" data-screen="routes">
      <section class="pad">
        <button class="primary wide" id="btnCreateRoute">
          <span class="plus">Ôºã</span> Vytvo≈ôit Novou Tra≈•
        </button>
      </section>

      <section class="list" id="routesList"></section>

      <section class="pad">
        <button class="dark wide" id="btnHistoryAll">Historie & ≈Ωeb≈ô√≠ƒçek</button>
      </section>
    </main>

    <!-- ROUTE DETAIL -->
    <main class="screen" id="screenRouteDetail" data-screen="route" hidden>
      <section class="pad">
        <div class="meta" id="routeMeta"></div>
      </section>

      <section class="card pad">
        <div class="card-title">Profil tratƒõ</div>
        <canvas id="profileCanvas" width="1200" height="420" aria-label="Profil tratƒõ"></canvas>
        <div class="hint">Tip: import GPX ti vytvo≈ô√≠ profil (v√Ω≈°ka vs vzd√°lenost). Checkpointy m≈Ø≈æe≈° m√≠t i bez vzd√°lenosti, ale pro znaƒçky v profilu se hod√≠.</div>
      </section>

      
      <section class="pad">
        <div class="card pad" id="compareCard">
          <div class="row between">
            <div class="card-title">Srovn√°n√≠ (TV re≈æim)</div>
            <div class="pill" id="compareMode">‚Äî</div>
          </div>
          <div class="compare-grid">
            <div class="compare-box">
              <div class="compare-title" id="cmpNextTitle">Dal≈°√≠ checkpoint</div>
              <div class="compare-line" id="cmpNextBest">Best: ‚Äî</div>
              <div class="compare-line" id="cmpNextTarget">C√≠l: ‚Äî</div>
            </div>
            <div class="compare-box">
              <div class="compare-title">C√≠l</div>
              <div class="compare-line" id="cmpFinishBest">Best: ‚Äî</div>
              <div class="compare-line" id="cmpFinishTarget">C√≠l: ‚Äî</div>
            </div>
          </div>
          <div class="hint" id="cmpHint">Zobrazuje rozd√≠l na nejlep≈°√≠ ƒçasy a z√°rove≈à ‚Äû≈æiv√Ω‚Äú c√≠l (dal≈°√≠ z√°znam v ≈æeb≈ô√≠ƒçku, kter√Ω je≈°tƒõ st√≠h√°≈° porazit).</div>
        </div>
      </section>



      <section class="pad">
        <div class="card pad" id="raceTrackCard">
          <div class="row between">
            <div class="card-title">Duel (TV vizualizace)</div>
            <div class="pill" id="duelLabel">Best vs Ty</div>
          </div>

          <div class="track-wrap">
            <div class="track" id="track">
              <div class="track-line" id="trackLine"></div>
              <div class="track-marks" id="trackMarks"></div>

              <div class="rider rider-best" id="riderBest" title="Best">
                <div class="rider-icon" aria-hidden="true">üö¥</div>
                <div class="rider-tag">BEST</div>
              </div>

              <div class="rider rider-you" id="riderYou" title="Ty">
                <div class="rider-icon" aria-hidden="true">üö¥</div>
                <div class="rider-tag">TY</div>
              </div>
            </div>
          </div>

          <div class="hint" id="duelHint">
            V prvn√≠m √∫seku jedete spolu. Po ka≈æd√©m checkpointu se pozice ‚Äûskokovƒõ‚Äú p≈ôepoƒç√≠taj√≠ podle rozd√≠lu celkov√©ho ƒçasu (mezera roste po 5 s).
          </div>
        </div>
      </section>


      <section class="card pad">
        <div class="row between">
          <div class="card-title">Checkpointy</div>
          <button class="icon-btn" id="btnAddCheckpoint" aria-label="P≈ôidat checkpoint">
            <svg viewBox="0 0 24 24"><path d="M12 5v14M5 12h14" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
          </button>
        </div>
        <div id="checkpointList" class="cp-list"></div>
        <div class="hint">Za j√≠zdy maƒçkej ‚ÄûDal≈°√≠ checkpoint‚Äú ‚Äì bere checkpointy v po≈ôad√≠.</div>
      </section>

      <section class="pad grid2">
        <button class="dark" id="btnEditRoute">Upravit Tra≈•</button>
        <button class="dark" id="btnImportGpx">Import GPX</button>
      </section>

      <section class="pad">
        <button class="primary wide" id="btnStartRide">Jet (mƒõ≈ôit)</button>
      </section>

      <section class="pad">
        <button class="ghost wide" id="btnRouteLeaderboard">≈Ωeb≈ô√≠ƒçek pro tuto tra≈•</button>
      </section>

      <section class="pad">
        <button class="ghost wide" id="btnSegmentLeaderboard">≈Ωeb≈ô√≠ƒçek checkpoint≈Ø (segmenty)</button>
      </section>
    </main>

    <!-- RIDE -->
    <main class="screen" id="screenRide" data-screen="ride" hidden>
      <section class="pad">
        <div class="timer" id="rideTimer">00:00:00</div>
      </section>

      <section class="card pad">
        <div class="row between">
          <div class="card-title" id="rideRouteName">J√≠zda</div>
          <div class="pill" id="rideNextLabel">Dal≈°√≠: ‚Äî</div>
        </div>

        <div class="ride-marks" id="rideMarks"></div>
      </section>

      <section class="pad grid2">
        <button class="orange" id="btnUndo">Zpƒõt</button>
        <button class="green" id="btnNextCheckpoint">Dal≈°√≠ Checkpoint</button>
      </section>

      <section class="pad grid2">
        <button class="red" id="btnStopRide">Ukonƒçit</button>
        <button class="blue" id="btnSaveRide" disabled>Ulo≈æit V√Ωsledek</button>
      </section>
    </main>

    <!-- BOTTOM SHEETS / MODALS -->

    <div class="modal" id="modalSegmentLeaderboard" hidden>
      <div class="sheet large">
        <div class="sheet-title" id="segTitle">≈Ωeb≈ô√≠ƒçek checkpoint≈Ø</div>
        <div class="hint" id="segHint"></div>
        <div id="segBody" class="seg-body"></div>
        <div class="row gap">
          <button class="ghost" data-close="modalSegmentLeaderboard">Zav≈ô√≠t</button>
        </div>
      </div>
      <div class="backdrop" data-close="modalSegmentLeaderboard"></div>
    </div>

    <div class="modal" id="modalMenu" hidden>
      <div class="sheet">
        <div class="sheet-title">Menu</div>

        <div class="hint" style="margin:-2px 0 10px 0">Aktu√°ln√≠ zdroj: <b id="currentSourceLabel">‚Äî</b></div>
        <button class="sheet-btn" id="btnSwitchSource">Zmƒõnit zdroj tras (Zwift/Kinomap)</button>

        <button class="sheet-btn" id="btnExport">Exportovat data (JSON)</button>
        <label class="sheet-btn file">
          Importovat data (JSON)
          <input type="file" id="fileImportJson" accept="application/json" />
        </label>
        <button class="sheet-btn danger" id="btnReset">Smazat v≈°echna data</button>
        <button class="sheet-btn" id="btnCloseMenu">Zav≈ô√≠t</button>
      </div>
      <div class="backdrop" data-close="modalMenu"></div>
    </div>

    <div class="modal" id="modalCreateRoute" hidden>
      <div class="sheet">
        <div class="sheet-title">Nov√° tra≈•</div>
        
        <label class="field">
          Zdroj
          <select id="newRouteSource">
            <option value="Zwift">Zwift</option>
            <option value="Kinomap">Kinomap</option>
          </select>
        </label>

        
        <label class="field">
          Zdroj
          <select id="editRouteSource">
            <option value="Zwift">Zwift</option>
            <option value="Kinomap">Kinomap</option>
          </select>
        </label>

        <label class="field">
          N√°zev tratƒõ
          <input type="text" id="newRouteName" placeholder="Nap≈ô. Alpsk√° V√Ωzva" />
        </label>
        <label class="field">
          D√©lka (km) ‚Äî voliteln√©
          <input type="number" inputmode="decimal" id="newRouteDistance" placeholder="25.6" />
        </label>
        <div class="row gap">
          <button class="primary" id="btnCreateRouteConfirm">Vytvo≈ôit</button>
          <button class="ghost" data-close="modalCreateRoute">Zru≈°it</button>
        </div>
      </div>
      <div class="backdrop" data-close="modalCreateRoute"></div>
    </div>

    <div class="modal" id="modalAddCheckpoint" hidden>
      <div class="sheet">
        <div class="sheet-title">Nov√Ω checkpoint</div>
        <label class="field">
          N√°zev checkpointu
          <input type="text" id="cpName" placeholder="Vrchol / Sjezd / Zat√°ƒçka‚Ä¶" />
        </label>
        <label class="field">
          Vzd√°lenost (km) ‚Äî voliteln√©
          <input type="number" inputmode="decimal" id="cpDistance" placeholder="12.8" />
        </label>
        <div class="row gap">
          <button class="primary" id="btnAddCheckpointConfirm">P≈ôidat</button>
          <button class="ghost" data-close="modalAddCheckpoint">Zru≈°it</button>
        </div>
        <div class="hint">Vzd√°lenost pom≈Ø≈æe zobrazit checkpoint v profilu. Klidnƒõ ji nech pr√°zdnou.</div>
      </div>
      <div class="backdrop" data-close="modalAddCheckpoint"></div>
    </div>

    <div class="modal" id="modalImportGpx" hidden>
      <div class="sheet">
        <div class="sheet-title">Import GPX</div>
        <p class="hint">Vyber GPX soubor trasy. Aplikace spoƒç√≠t√° vzd√°lenost, p≈ôev√Ω≈°en√≠ a profil. (Soukrom√≠: data z≈Øst√°vaj√≠ v telefonu.)</p>
        <label class="sheet-btn file">
          Vybrat GPX
          <input type="file" id="fileGpx" accept=".gpx,application/gpx+xml,application/xml,text/xml" />
        </label>
        <div class="row gap">
          <button class="ghost" data-close="modalImportGpx">Zav≈ô√≠t</button>
        </div>
      </div>
      <div class="backdrop" data-close="modalImportGpx"></div>
    </div>

    <div class="modal" id="modalEditRoute" hidden>
      <div class="sheet">
        <div class="sheet-title">Upravit tra≈•</div>
        <label class="field">
          N√°zev
          <input type="text" id="editRouteName" />
        </label>
        <label class="field">
          D√©lka (km) ‚Äî voliteln√©
          <input type="number" inputmode="decimal" id="editRouteDistance" />
        </label>
        <div class="row gap">
          <button class="primary" id="btnEditRouteSave">Ulo≈æit</button>
          <button class="ghost" data-close="modalEditRoute">Zru≈°it</button>
        </div>
        <hr class="sep"/>
        <button class="sheet-btn danger" id="btnDeleteRoute">Smazat tra≈•</button>
      </div>
      <div class="backdrop" data-close="modalEditRoute"></div>
    </div>

    <div class="modal" id="modalSaveRide" hidden>
      <div class="sheet">
        <div class="sheet-title">Ulo≈æit v√Ωsledek</div>
        <div class="mini" id="saveRideSummary"></div>
        <label class="field">
          Z√°vodn√≠k / n√°zev pokusu (voliteln√©)
          <input type="text" id="rideRunnerName" placeholder="Nap≈ô. Pokus #3 / FTP / Race" />
        </label>
        <label class="field">
          Pozn√°mka (voliteln√©)
          <textarea id="rideNote" rows="3" placeholder="Nap≈ô. odpor 5/10, pocit, tep‚Ä¶"></textarea>
        </label>
        <div class="row gap">
          <button class="primary" id="btnSaveRideConfirm">Ulo≈æit</button>
          <button class="ghost" data-close="modalSaveRide">Zru≈°it</button>
        </div>
      </div>
      <div class="backdrop" data-close="modalSaveRide"></div>
    </div>

    <div class="modal" id="modalLeaderboard" hidden>
      <div class="sheet large">
        <div class="sheet-title" id="leaderTitle">≈Ωeb≈ô√≠ƒçek</div>
        <div class="hint" id="leaderHint"></div>
        <div id="leaderList" class="leader-list"></div>
        <div class="row gap">
          <button class="ghost" data-close="modalLeaderboard">Zav≈ô√≠t</button>
        </div>
      </div>
      <div class="backdrop" data-close="modalLeaderboard"></div>
    </div>

    <div id="toast" class="toast" hidden></div>
  </div>

  <script src="app.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => navigator.serviceWorker.register('./sw.js').catch(()=>{}));
    }
  </script>
</body>
</html>
